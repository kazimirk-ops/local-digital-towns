<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sebastian Digital Town</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <style>
      :root { --bg:#070b10; --panel:#0f1722; --text:#e8eef6; --muted:#9fb0c3; --mint:#00ffae; }
      * { box-sizing:border-box; }
      body { margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif; background:linear-gradient(180deg,#070b10,#05070b); color:var(--text); }
      header { position:sticky; top:0; z-index:10; padding:12px 16px; background:rgba(10,14,20,.88); backdrop-filter: blur(10px); border-bottom:1px solid rgba(255,255,255,.06); }
      .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
      .title { display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.3px; }
      .dot { width:10px; height:10px; border-radius:999px; background:var(--mint); box-shadow:0 0 18px rgba(0,255,170,.45); }
      .pill { display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.10); background:rgba(15,23,34,.65); font-size:12px; color:#cfe3ff; text-decoration:none; }
      .muted { color:var(--muted); font-size:12px; }
      .layout { display:grid; grid-template-columns:1.45fr 1fr; gap:12px; padding:12px; max-width:1480px; margin:0 auto; }
      .card { background:rgba(15,23,34,.78); border:1px solid rgba(255,255,255,.10); border-radius:14px; overflow:hidden; }
      .cardHead { padding:12px; border-bottom:1px solid rgba(255,255,255,.07); display:flex; justify-content:space-between; gap:10px; }
      .cardBody { padding:12px; }
      .mapWrap { position:relative; height:680px; border-radius:14px; border:1px solid rgba(255,255,255,.10); overflow:hidden; }
      #map { position:absolute; inset:0; }
      .districtBar { position:absolute; top:12px; left:12px; display:flex; flex-wrap:wrap; gap:8px; z-index:999; }
      .dBtn { padding:8px 10px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(10,14,20,.65); color:var(--text); cursor:pointer; font-size:12px; font-weight:800; }
      .dBtn.active { border-color:var(--mint); box-shadow:0 10px 30px rgba(0,255,170,.12); }
      .authBanner { border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px; background:rgba(10,14,20,.35); display:flex; justify-content:space-between; gap:10px; align-items:center; }
      .authTitle { font-weight:900; }
      .debugBox { border:1px solid rgba(255,204,0,.25); background:rgba(255,204,0,.07); border-radius:12px; padding:10px; margin-top:10px; }
      .mono { font-family: ui-monospace, Menlo, Consolas, monospace; font-size:12px; white-space: pre-wrap; }
      .list { display:flex; flex-direction:column; gap:8px; margin-top:10px; }
      .item { border:1px solid rgba(255,255,255,.10); border-radius:12px; padding:10px; background:rgba(10,14,20,.30); }
      input, textarea, select { width:100%; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background:#0b1220; color:var(--text); }
      textarea { min-height:80px; }
      button { padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:#0b1220; color:var(--text); cursor:pointer; }
      button:disabled { opacity:.5; cursor:not-allowed; }
      hr { border:none; border-top:1px solid rgba(255,255,255,.08); margin:12px 0; }
      .twoCol { display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
      @media (max-width:1100px){ .layout { grid-template-columns:1fr; } .mapWrap { height:560px; } .twoCol{ grid-template-columns:1fr; } }
    </style>
  </head>
  <body>
    <header>
      <div class="row" style="justify-content:space-between;">
        <div class="row">
          <div class="title"><span class="dot"></span> Sebastian Digital Town</div>
          <span class="pill" id="apiStatus">API: …</span>
          <a class="pill" href="/signup">Join Pilot</a>
          <a class="pill" href="/sweepstake">Sweepstake</a>
          <span class="pill">Sweep: <span id="sweepBal">0</span></span>
          <span class="muted">Sebastian only</span>
        </div>
      </div>
    </header>

    <div class="layout">
      <div class="card">
        <div class="cardHead">
          <div>
            <strong>Sebastian Map</strong>
            <div class="muted">Shadow analytics + Sweep rewards</div>
          </div>
        </div>
        <div class="cardBody">
          <div class="mapWrap">
            <div id="map"></div>
            <div class="districtBar">
              <button class="dBtn" data-district="1">Market Square</button>
              <button class="dBtn" data-district="2">Service Row</button>
              <button class="dBtn" data-district="3">Retail Way</button>
              <button class="dBtn" data-district="4">Marina / Live Hall</button>
              <button class="dBtn" data-district="5">Town Hall</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <strong>Control Panel</strong>
            <div class="muted" id="metricsTime">—</div>
          </div>
        </div>
        <div class="cardBody">
          <div class="authBanner">
            <div>
              <div class="authTitle" id="authTitle">Checking login…</div>
              <div class="muted" id="authTag">—</div>
            </div>
            <div class="row">
              <button id="logoutBtn">Logout</button>
              <a class="pill" href="/admin/sweep">Operator Toolkit</a>
            </div>
          </div>

          <div class="debugBox">
            <strong>Status</strong>
            <div class="mono" id="debug">(ready)</div>
          </div>

          <hr />

          <h4>Places</h4>
          <div class="list" id="places"></div>

          <hr />

          <h4>Place Settings</h4>
          <div class="twoCol" style="margin-top:8px;">
            <div>
              <label class="muted">Seller Type</label>
              <select id="sellerType">
                <option value="individual">individual</option>
                <option value="business">business</option>
              </select>
            </div>
            <div>
              <label class="muted">Visibility</label>
              <select id="visibilityLevel">
                <option value="town_only">town_only</option>
                <option value="zone">zone</option>
                <option value="exact_address">exact_address</option>
                <option value="meetup_only">meetup_only</option>
              </select>
            </div>
          </div>
          <div style="margin-top:8px;"><input id="pickupZone" placeholder="Pickup Zone (optional)" /></div>
          <div style="margin-top:8px;"><input id="addressPublic" placeholder="Public Address (optional)" /></div>
          <div style="margin-top:8px;"><input id="meetupInstructions" placeholder="Meetup Instructions (optional)" /></div>
          <div style="margin-top:8px;"><input id="hours" placeholder="Hours (optional)" /></div>
          <div class="row" style="margin-top:8px;"><button id="savePlaceSettings">Save Place Settings</button></div>

          <hr />

          <h4>Listings</h4>
          <div class="list" id="listings"></div>

          <h4>Create Listing</h4>
          <div class="muted">Eligible users only.</div>
          <input id="newTitle" placeholder="Title" />
          <input id="newDesc" placeholder="Description" />
          <input id="newQty" value="1" />
          <input id="newPrice" value="99" />
          <button id="createListingBtn">Create Listing</button>

          <hr />

          <h4>Conversations</h4>
          <div class="row">
            <button id="viewerBuyer">Viewer: buyer</button>
            <button id="viewerSeller">Viewer: seller</button>
            <button id="markReadBtn">Mark Read</button>
          </div>
          <div class="muted" id="viewerLabel"></div>
          <div class="list" id="conversations"></div>

          <h4>Messages</h4>
          <div class="list" id="messages"></div>
          <input id="sender" value="buyer" />
          <textarea id="msgText"></textarea>
          <button id="sendMsg">Send Message</button>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="/app.js?v=actorrole1"></script>
  </body>
</html>

