<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sebastian Digital Town – Map</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 0; background:#0b0f14; color:#e8eef6; }
      header { padding: 12px 16px; background: #111; color: #fff; position: sticky; top: 0; z-index: 10; }
      .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
      .pill { display:inline-block; padding: 2px 10px; border-radius: 999px; border: 1px solid #2b3a4d; font-size: 12px; background:#0f1722; color:#cfe3ff; }
      .muted { color: #9fb0c3; font-size: 12px; }
      code { background: #121a25; padding: 2px 6px; border-radius: 4px; border:1px solid #223149; }

      .layout {
        display: grid;
        grid-template-columns: 1.4fr 1fr;
        gap: 12px;
        padding: 12px;
        max-width: 1400px;
        margin: 0 auto;
      }
      .card { background: #0f1722; border: 1px solid #223149; border-radius: 12px; padding: 12px; }
      h3, h4 { margin: 8px 0; }
      hr { border: none; border-top: 1px solid #223149; margin: 12px 0; }
      .list { display:flex; flex-direction:column; gap:8px; margin-top: 10px; }
      .item { border: 1px solid #223149; border-radius: 10px; padding: 10px; background: rgba(10,14,20,0.35); cursor: pointer; }
      .item:hover { background: rgba(20,30,45,0.40); border-color: rgba(140,200,255,0.35); }
      input, textarea { width: 100%; padding: 8px; border-radius: 8px; border:1px solid #223149; background:#0b1220; color:#e8eef6; }
      textarea { min-height: 70px; }
      button { padding: 8px 12px; border-radius: 10px; border: 1px solid #223149; background:#0b1220; color:#e8eef6; cursor:pointer; }
      button:hover { background:#0f1722; border-color: rgba(140,200,255,0.35); }
      .mono { font-family: ui-monospace, Menlo, Consolas, monospace; font-size: 12px; white-space: pre-wrap; }

      .debugBox {
        border: 1px solid rgba(255,200,0,0.35);
        background: rgba(255,200,0,0.08);
        padding: 10px;
        border-radius: 12px;
        margin-top: 10px;
      }

      /* Town Health */
      .metricsGrid { display:grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top:10px; }
      .metric {
        border: 1px solid rgba(255,255,255,0.10);
        border-radius: 10px;
        padding: 10px;
        background: rgba(0,0,0,0.15);
      }
      .metric .k { font-size: 12px; color:#9fb0c3; }
      .metric .v { font-size: 18px; font-weight: 800; margin-top: 4px; }
      .healthBig { display:flex; justify-content: space-between; gap: 10px; align-items: center; margin-top: 10px; }
      .healthBig .v { font-size: 28px; font-weight: 900; }
      .healthBig .k { font-size: 12px; color:#9fb0c3; }
      .bar { height: 10px; border-radius: 999px; background: rgba(255,255,255,0.08); overflow:hidden; flex: 1; }
      .bar > div { height: 100%; width: 0%; background: rgba(0,255,170,0.55); }

      /* MAP */
      .mapWrap { position: relative; min-height: 620px; overflow: hidden; border-radius: 12px;
        background: radial-gradient(circle at 30% 20%, rgba(46,147,255,0.14), transparent 45%),
                    radial-gradient(circle at 80% 70%, rgba(0,255,170,0.10), transparent 45%),
                    linear-gradient(180deg, #0b1220, #070b10);
        border: 1px solid #223149;
      }
      .mapGrid { position: absolute; inset: 0;
        background-image: linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
                          linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
        background-size: 40px 40px; opacity: 0.45; pointer-events: none;
      }
      .district { position: absolute; width: 260px; height: 120px; border-radius: 16px;
        border: 1px solid rgba(255,255,255,0.12); background: rgba(15,23,34,0.78);
        box-shadow: 0 8px 30px rgba(0,0,0,0.35); cursor: pointer; padding: 12px;
        display:flex; flex-direction:column; justify-content:space-between;
      }
      .district:hover { border-color: rgba(140,200,255,0.45); background: rgba(19,31,48,0.86); }
      .district.active { border-color: rgba(0,255,170,0.55); box-shadow: 0 10px 40px rgba(0,255,170,0.10); }
      .dTitle { font-weight: 700; }
      .dMeta { font-size: 12px; color: #b9c7d8; display:flex; gap:10px; flex-wrap: wrap; }
      .badge { font-size: 12px; padding: 2px 8px; border-radius: 999px; border:1px solid rgba(255,255,255,0.14); color:#cfe3ff; background: rgba(0,0,0,0.18); }

      #d-market { left: 58%; top: 45%; }
      #d-service { left: 18%; top: 45%; }
      #d-retail { left: 42%; top: 72%; width: 320px; }
      #d-live { left: 40%; top: 16%; width: 320px; }
      #d-civic { left: 8%; top: 72%; width: 300px; }

      @media (max-width: 1100px) {
        .layout { grid-template-columns: 1fr; }
        .mapWrap { min-height: 560px; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="row">
        <strong>Sebastian Digital Town – Map View</strong>
        <span class="pill" id="apiStatus">API: …</span>
        <span class="muted">Sebastian only | UI at <code>/ui</code></span>
      </div>
    </header>

    <div class="layout">
      <div class="card">
        <h3>Town Map</h3>
        <div class="muted">Click a district to enter it. Then pick a place.</div>

        <div class="mapWrap">
          <div class="mapGrid"></div>

          <div class="district" id="d-live" data-district="4">
            <div class="dTitle">Marina / Live Hall</div>
            <div class="dMeta"><span class="badge">Live: 0</span><span class="badge">Events: 0</span></div>
          </div>

          <div class="district" id="d-service" data-district="2">
            <div class="dTitle">Service Row</div>
            <div class="dMeta"><span class="badge" id="badge-service-places">Places: …</span></div>
          </div>

          <div class="district" id="d-market" data-district="1">
            <div class="dTitle">Market Square</div>
            <div class="dMeta">
              <span class="badge" id="badge-market-places">Places: …</span>
              <span class="badge" id="badge-market-listings">Listings: …</span>
            </div>
          </div>

          <div class="district" id="d-retail" data-district="3">
            <div class="dTitle">Retail Way</div>
            <div class="dMeta"><span class="badge" id="badge-retail-places">Places: …</span></div>
          </div>

          <div class="district" id="d-civic" data-district="5">
            <div class="dTitle">Town Hall</div>
            <div class="dMeta"><span class="badge">Civic</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Sebastian Control Panel</h3>
        <div class="muted" id="rightHint">Town health + district exploration.</div>

        <div class="debugBox">
          <strong>Status / Debug</strong>
          <div class="mono" id="debug">(ready)</div>
        </div>

        <hr />

        <h4>Town Health</h4>
        <div class="muted">Internal metrics (not public). Updated automatically.</div>

        <div class="healthBig">
          <div>
            <div class="k">Town Health Index</div>
            <div class="v" id="healthIndex">—</div>
            <div class="muted" id="metricsTime">—</div>
          </div>
          <div class="bar"><div id="healthBar"></div></div>
        </div>

        <div class="metricsGrid">
          <div class="metric"><div class="k">Places</div><div class="v" id="mPlaces">—</div></div>
          <div class="metric"><div class="k">Listings (Active)</div><div class="v" id="mActiveListings">—</div></div>
          <div class="metric"><div class="k">Listings (Total)</div><div class="v" id="mTotalListings">—</div></div>
          <div class="metric"><div class="k">Listings (Sold)</div><div class="v" id="mSoldListings">—</div></div>
          <div class="metric"><div class="k">Conversations</div><div class="v" id="mConversations">—</div></div>
          <div class="metric"><div class="k">Messages</div><div class="v" id="mMessages">—</div></div>
        </div>

        <hr />

        <h4>Places</h4>
        <div class="list" id="places"></div>

        <hr />

        <h4>Listings</h4>
        <div class="list" id="listings"></div>

        <h4 style="margin-top:10px;">Create Listing</h4>
        <div class="muted">Creates a listing for the selected Place.</div>
        <div style="margin-top:8px;">
          <input id="newTitle" placeholder="Title" />
        </div>
        <div style="margin-top:8px;">
          <input id="newDesc" placeholder="Description" />
        </div>
        <div class="row" style="margin-top:8px;">
          <input id="newQty" placeholder="Quantity" value="1" />
          <input id="newPrice" placeholder="Price" value="99" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button id="createListingBtn">Create Listing</button>
        </div>

        <hr />

        <h4>Conversations</h4>
        <div class="row">
          <button id="viewerBuyer">Viewer: buyer</button>
          <button id="viewerSeller">Viewer: seller</button>
          <button id="markReadBtn">Mark Read</button>
        </div>
        <div class="muted" id="viewerLabel"></div>
        <div class="list" id="conversations"></div>

        <hr />

        <h4>Messages</h4>
        <div class="list" id="messages"></div>

        <div style="margin-top:10px;">
          <input id="sender" placeholder="sender (buyer or seller)" value="buyer" />
        </div>
        <div style="margin-top:8px;">
          <textarea id="msgText" placeholder="type a message..."></textarea>
        </div>
        <div class="row" style="margin-top:8px;">
          <button id="sendMsg">Send Message</button>
        </div>
      </div>
    </div>

    <script src="/app.js?v=health1"></script>
  </body>
</html>

