ALTER TABLE places ADD COLUMN IF NOT EXISTS sellerType TEXT NOT NULL DEFAULT 'individual';
ALTER TABLE places ADD COLUMN IF NOT EXISTS visibilityLevel TEXT NOT NULL DEFAULT 'town_only';
ALTER TABLE places ADD COLUMN IF NOT EXISTS pickupZone TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS addressPublic TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS addressPrivate TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS meetupInstructions TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS hours TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS verifiedStatus TEXT NOT NULL DEFAULT 'unverified';
ALTER TABLE places ADD COLUMN IF NOT EXISTS ownerUserId INTEGER;
ALTER TABLE places ADD COLUMN IF NOT EXISTS description TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS website TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS yearsInTown TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS bannerUrl TEXT NOT NULL DEFAULT '';
ALTER TABLE places ADD COLUMN IF NOT EXISTS avatarUrl TEXT NOT NULL DEFAULT '';

ALTER TABLE users ADD COLUMN IF NOT EXISTS trustTier INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS trustTierUpdatedAt TEXT NOT NULL DEFAULT '';
ALTER TABLE users ADD COLUMN IF NOT EXISTS phone TEXT NOT NULL DEFAULT '';
ALTER TABLE users ADD COLUMN IF NOT EXISTS addressJson JSONB NOT NULL DEFAULT '{}'::jsonb;
ALTER TABLE users ADD COLUMN IF NOT EXISTS presenceVerifiedAt TEXT NOT NULL DEFAULT '';
ALTER TABLE users ADD COLUMN IF NOT EXISTS presenceLat DOUBLE PRECISION;
ALTER TABLE users ADD COLUMN IF NOT EXISTS presenceLng DOUBLE PRECISION;
ALTER TABLE users ADD COLUMN IF NOT EXISTS presenceAccuracyMeters DOUBLE PRECISION;
ALTER TABLE users ADD COLUMN IF NOT EXISTS displayName TEXT NOT NULL DEFAULT '';
ALTER TABLE users ADD COLUMN IF NOT EXISTS bio TEXT NOT NULL DEFAULT '';
ALTER TABLE users ADD COLUMN IF NOT EXISTS avatarUrl TEXT NOT NULL DEFAULT '';
ALTER TABLE users ADD COLUMN IF NOT EXISTS interestsJson JSONB NOT NULL DEFAULT '[]'::jsonb;
ALTER TABLE users ADD COLUMN IF NOT EXISTS ageRange TEXT NOT NULL DEFAULT '';
ALTER TABLE users ADD COLUMN IF NOT EXISTS showAvatar INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS showBio INTEGER NOT NULL DEFAULT 1;
ALTER TABLE users ADD COLUMN IF NOT EXISTS showInterests INTEGER NOT NULL DEFAULT 1;
ALTER TABLE users ADD COLUMN IF NOT EXISTS showAgeRange INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS isBuyerVerified INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS isSellerVerified INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS locationVerifiedSebastian INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS residentVerified INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS facebookVerified INTEGER NOT NULL DEFAULT 0;
ALTER TABLE users ADD COLUMN IF NOT EXISTS isAdmin INTEGER NOT NULL DEFAULT 0;

ALTER TABLE channel_messages ADD COLUMN IF NOT EXISTS imageUrl TEXT NOT NULL DEFAULT '';

ALTER TABLE live_rooms ADD COLUMN IF NOT EXISTS hostEventId INTEGER;
ALTER TABLE live_rooms ADD COLUMN IF NOT EXISTS hostType TEXT NOT NULL DEFAULT 'individual';

ALTER TABLE sweep_draws ADD COLUMN IF NOT EXISTS notified INTEGER NOT NULL DEFAULT 0;
ALTER TABLE sweep_draws ADD COLUMN IF NOT EXISTS claimedAt TEXT NOT NULL DEFAULT '';
ALTER TABLE sweep_draws ADD COLUMN IF NOT EXISTS claimedByUserId INTEGER;
ALTER TABLE sweep_draws ADD COLUMN IF NOT EXISTS claimedMessage TEXT NOT NULL DEFAULT '';
ALTER TABLE sweep_draws ADD COLUMN IF NOT EXISTS claimedPhotoUrl TEXT NOT NULL DEFAULT '';
ALTER TABLE sweep_draws ADD COLUMN IF NOT EXISTS claimedPostedMessageId INTEGER;

ALTER TABLE listings ADD COLUMN IF NOT EXISTS photoUrlsJson JSONB NOT NULL DEFAULT '[]'::jsonb;
ALTER TABLE listings ADD COLUMN IF NOT EXISTS listingType TEXT NOT NULL DEFAULT 'item';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS exchangeType TEXT NOT NULL DEFAULT 'money';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS startAt TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS endAt TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS offerCategory TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS availabilityWindow TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS compensationType TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS auctionStartAt TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS auctionEndAt TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS startBidCents INTEGER NOT NULL DEFAULT 0;
ALTER TABLE listings ADD COLUMN IF NOT EXISTS minIncrementCents INTEGER NOT NULL DEFAULT 0;
ALTER TABLE listings ADD COLUMN IF NOT EXISTS reserveCents INTEGER;
ALTER TABLE listings ADD COLUMN IF NOT EXISTS buyNowCents INTEGER;
ALTER TABLE listings ADD COLUMN IF NOT EXISTS auctionStatus TEXT NOT NULL DEFAULT 'active';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS winningBidId INTEGER;
ALTER TABLE listings ADD COLUMN IF NOT EXISTS winnerUserId INTEGER;
ALTER TABLE listings ADD COLUMN IF NOT EXISTS paymentDueAt TEXT NOT NULL DEFAULT '';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS paymentStatus TEXT NOT NULL DEFAULT 'none';
ALTER TABLE listings ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;

ALTER TABLE events ADD COLUMN IF NOT EXISTS title TEXT NOT NULL DEFAULT '';
ALTER TABLE events ADD COLUMN IF NOT EXISTS description TEXT NOT NULL DEFAULT '';
ALTER TABLE events ADD COLUMN IF NOT EXISTS startsAt TEXT NOT NULL DEFAULT '';
ALTER TABLE events ADD COLUMN IF NOT EXISTS endsAt TEXT NOT NULL DEFAULT '';
ALTER TABLE events ADD COLUMN IF NOT EXISTS locationName TEXT NOT NULL DEFAULT '';
ALTER TABLE events ADD COLUMN IF NOT EXISTS isPublic INTEGER NOT NULL DEFAULT 1;
ALTER TABLE events ADD COLUMN IF NOT EXISTS organizerUserId INTEGER;

ALTER TABLE orders ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS sellerPlaceId INTEGER;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS updatedAt TEXT NOT NULL DEFAULT '';
ALTER TABLE orders ADD COLUMN IF NOT EXISTS subtotalCents INTEGER NOT NULL DEFAULT 0;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS serviceGratuityCents INTEGER NOT NULL DEFAULT 0;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS totalCents INTEGER NOT NULL DEFAULT 0;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS fulfillmentType TEXT NOT NULL DEFAULT '';
ALTER TABLE orders ADD COLUMN IF NOT EXISTS fulfillmentNotes TEXT NOT NULL DEFAULT '';

ALTER TABLE reviews ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE disputes ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE bids ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE channels ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE direct_conversations ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE direct_messages ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE signups ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE event_rsvps ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE sweep_ledger ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE sweepstakes ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE sweepstake_entries ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;
ALTER TABLE store_follows ADD COLUMN IF NOT EXISTS townId INTEGER NOT NULL DEFAULT 1;

ALTER TABLE town_memberships ADD COLUMN IF NOT EXISTS trustTier INTEGER NOT NULL DEFAULT 0;
ALTER TABLE sweepstakes ADD COLUMN IF NOT EXISTS maxEntriesPerUserPerDay INTEGER NOT NULL DEFAULT 1;
ALTER TABLE sweepstake_entries ADD COLUMN IF NOT EXISTS entries INTEGER NOT NULL DEFAULT 0;
ALTER TABLE sweepstake_entries ADD COLUMN IF NOT EXISTS dayKey TEXT NOT NULL DEFAULT '';

CREATE INDEX IF NOT EXISTS idx_listings_town_created ON listings(townId, createdAt DESC);
CREATE INDEX IF NOT EXISTS idx_orders_town_created ON orders(townId, createdAt DESC);
CREATE INDEX IF NOT EXISTS idx_bids_town_created ON bids(townId, createdAt DESC);
CREATE INDEX IF NOT EXISTS idx_reviews_town_created ON reviews(townId, createdAt DESC);
CREATE INDEX IF NOT EXISTS idx_disputes_town_created ON disputes(townId, createdAt DESC);
CREATE INDEX IF NOT EXISTS idx_channels_town_created ON channels(townId, createdAt DESC);
CREATE INDEX IF NOT EXISTS idx_dm_town_created ON direct_messages(townId, createdAt DESC);
CREATE INDEX IF NOT EXISTS idx_media_town ON media_objects(townId);
CREATE INDEX IF NOT EXISTS idx_media_owner ON media_objects(ownerUserId);
CREATE INDEX IF NOT EXISTS idx_media_kind ON media_objects(kind);
CREATE INDEX IF NOT EXISTS idx_media_created ON media_objects(createdAt DESC);
